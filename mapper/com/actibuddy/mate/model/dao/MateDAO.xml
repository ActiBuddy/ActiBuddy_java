<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="MateDAO">

 <resultMap type="com.actibuddy.mate.model.dto.MateReviewDTO" id="mateReviewResultMap">
		<id property="num" column="MT_REVIEW_NUM"/>
		<result property="title" column="MT_REVIEW_TITLE"/>
		<result property="img1" column="MT_REVIEW_IMG1"/>
		<result property="img2" column="MT_REVIEW_IMG2"/>
		<result property="img3" column="MT_REVIEW_IMG3"/>
		<result property="content" column="MT_REVIEW_CON"/>
		<result property="date" column="MT_REVIEW_DATE"/>
		<result property="repYn" column="MT_REVIEW_REP_YN"/>
		<result property="userId" column="USER_ID"/>
	</resultMap>
	
    <resultMap type="com.actibuddy.mate.model.dto.MateReviewDTO" id="mateMainResultMap">
		<collection property="reviewList" resultMap="mateReviewResultMap"></collection>
	</resultMap>

	<!-- 메이트 후기 페이징 -->
	<select id="selectReviewTotalCount" resultType="_int">
		SELECT
				COUNT(*)
		  FROM MT_REVIEW A
         WHERE A.MT_REVIEW_TITLE LIKE '%' || #{ searchValue } || '%'
	</select>	
	
	<!-- 메이트 리뷰 전체 조회 -->
	<select id="selectReviewList" resultMap="mateReviewResultMap">
		SELECT C.RNUM
    	     , C.MT_REVIEW_NUM
   			 , C.MT_REVIEW_TITLE
  			 , C.MT_REVIEW_IMG1
		     , C.MT_REVIEW_CON  
		     , C.MT_REVIEW_DATE
		     , C.MT_REVIEW_REP_YN
		     , C.USER_ID
		     , C.MT_REVIEW_IMG2
		     , C.MT_REVIEW_IMG3
  		  FROM (SELECT ROWNUM RNUM
			        , B.MT_REVIEW_NUM
			        , B.MT_REVIEW_TITLE
			        , B.MT_REVIEW_IMG1
			        , B.MT_REVIEW_CON
			        , B.MT_REVIEW_DATE
			        , B.MT_REVIEW_REP_YN
			        , B.USER_ID
			        , B.MT_REVIEW_IMG2
		        	, B.MT_REVIEW_IMG3	
      			 FROM (SELECT
			              A.MT_REVIEW_NUM
			            , A.MT_REVIEW_TITLE
			            , A.MT_REVIEW_IMG1
			            , A.MT_REVIEW_CON
			            , A.MT_REVIEW_DATE
			            , A.MT_REVIEW_REP_YN
			            , A.USER_ID
			            , A.MT_REVIEW_IMG2
			            , A.MT_REVIEW_IMG3
     				   FROM MT_REVIEW A
     			      ORDER BY A.MT_REVIEW_DATE DESC) B
     			      
     			      )C
     	 WHERE (C.RNUM BETWEEN #{ startRow } and #{ endRow })
     	   <if test="searchValue != null">
     	  	 AND C.MT_REVIEW_TITLE LIKE '%' || #{ searchValue } || '%'
     	   </if>
	</select>

	<!-- 메이트 후기 작성 -->
	<insert id="insertReview">
		INSERT
		  INTO MT_REVIEW A
		(
		  A.MT_REVIEW_NUM
		, A.MT_REVIEW_TITLE
		, A.MT_REVIEW_IMG1
		, A.MT_REVIEW_CON
		, A.MT_REVIEW_DATE
		, A.MT_REVIEW_REP_YN
		, A.USER_ID
		, A.MT_REVIEW_IMG2
		, A.MT_REVIEW_IMG3
		)
		VALUES
		(
		  'MT_REVIEW' || SEQ_MT_REVIEW_NUM.NEXTVAL
        , #{ title }
        , #{ img1 }
        , #{ content }
        , default
        , #{ repYn }
        , #{ userId } 
        , #{ img2 }
        , #{ img3 }
		)

	</insert>

</mapper>
