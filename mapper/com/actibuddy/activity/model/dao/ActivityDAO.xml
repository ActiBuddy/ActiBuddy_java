<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="ActivityDAO">
 	
 	<resultMap type="com.actibuddy.activity.model.dto.LocationDTO" id="locationResultMap">
 	   <id property="code" column="LOCATION_CODE"/>
 	   <result property="name" column="LOCATION_NAME"/>
 	   <result property="info" column="LOCATION_INFO"/>
 	   <result property="image" column="LOCATION_IMG"/>
 	   <result property="tip" column="GUIDE_TIP"/>
 	   <result property="visitMonth" column="VISIT_MONTH"/>
 	   <result property="visitName" column="VISIT_NAME"/>
 	   <collection property="activityList" resultMap="activityAndReviewMap"/>
 	</resultMap>
 	
 	<resultMap type="com.actibuddy.activity.model.dto.ActivityDTO" id="activityResultMap">
 	   <id property="code" column="ACTI_NUM"/>
 	   <result property="name" column="ACTI_NAME"/>
 	   <result property="location" column="LOCATION"/>
 	   <result property="price" column="PRICE"/>
 	   <result property="StartDate" column="START_DATE"/>
 	   <result property="EndDate" column="END_DATE"/>
 	   <result property="tip" column="ACTI_TIP"/>
 	   <result property="image" column="ACTI_IMG"/>
 	   <result property="loactionCode" column="LOCATION_CODE"/>
 	   <result property="activitTypeCode" column="ACTI_TYPE_NUM"/>
 	   <result property="userId" column="USER_ID"/>
 	</resultMap>
 	
 	<resultMap type="com.actibuddy.activity.model.dto.ActiReviewDTO" id="reviewResultMap">
 	<id property="num" column="ACTI_REVIEW_NUM"/>
 	<result property="writeDate" column="ACTI_REVIEW_DATE"/>
 	<result property="actiNum" column="ACTI_NUM"/>
 	<result property="userId" column="USER_ID"/>
 	<result property="title" column="ACTI_REVIEW_TITLE"/>
 	<result property="content" column="ACTI_REVIEW_CON"/>
 	<result property="reviewStar" column="ACTI_REVIEW_STAR"/>
 	<result property="image" column="ACTI_REVIEW_IMG"/>
 	<result property="recommend" column="ACTI_REVIEW_REC"/>
 	<result property="recYn" column="ACTI_REVIEW_REP_YN"/>
 	</resultMap>
 	
 	<resultMap type="com.actibuddy.activity.model.dto.ActivityAndReviewDTO" id="activityAndReviewMap">
 	<id property="code" column="ACTI_NUM"/>
 	   <result property="name" column="ACTI_NAME"/>
 	   <result property="location" column="LOCATION"/>
 	   <result property="price" column="PRICE"/>
 	   <result property="StartDate" column="START_DATE"/>
 	   <result property="EndDate" column="END_DATE"/>
 	   <result property="tip" column="ACTI_TIP"/>
 	   <result property="image" column="ACTI_IMG"/>
 	   <result property="loactionCode" column="LOCATION_CODE"/>
 	   <result property="activitTypeCode" column="ACTI_TYPE_NUM"/>
 	   <result property="userId" column="USER_ID"/>
 	   <result property="avgStar" column="AVG"/>
 	   <result property="count" column="COUNT"/>
 	  <collection property="reviewList" resultMap="reviewResultMap"/>
 	</resultMap>
 	
 	<select id="selectLocationInfo" resultMap="locationResultMap" parameterType="string">
	 	SELECT
	      	  A.*
            , B.*
            , C.*
	  	  FROM LOCATION A
	      LEFT JOIN ACTIVITY_INFO B ON (A.LOCATION_CODE = B.LOCATION_CODE)
	      LEFT JOIN ACTI_REVIEW C ON (B.ACTI_NUM = C.ACTI_NUM)
	     WHERE A.LOCATION_NAME = #{ locationName }
 	</select>
 	
 	<select id="selectActivityInfo" resultMap="activityAndReviewMap" parameterType="String">
 	    
 	    SELECT 
               A.*
             , B.* 
             , (SELECT ROUND(AVG(C.ACTI_REVIEW_STAR),1)
                  FROM ACTI_REVIEW C
                  JOIN ACTIVITY_INFO B ON (C.ACTI_NUM = B.ACTI_NUM)
                 WHERE B.ACTI_NAME = #{ actiName })AS AVG
             ,(SELECT COUNT(c.acti_review_title)
         		 FROM ACTI_REVIEW C
         		 JOIN ACTIVITY_INFO B ON (C.ACTI_NUM = B.ACTI_NUM)
         		WHERE B.ACTI_NAME = #{ actiName })AS COUNT    
          FROM ACTIVITY_INFO A
          JOIN ACTI_REVIEW B ON(A.ACTI_NUM = B.ACTI_NUM)
         WHERE A.ACTI_NAME = #{ actiName }
 	
 	</select>
 
 </mapper>