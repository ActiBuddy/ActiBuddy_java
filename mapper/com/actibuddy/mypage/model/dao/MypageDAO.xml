<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="MypageDAO">
  	
   <resultMap type="com.actibuddy.member.model.dto.MemberDTO" id="memberResultMap">
		<id property="userId" column="USER_ID"/>
		<result property="userName" column="USER_NAME"/>
		<result property="pwd" column="PASSWORD"/>
		<result property="email" column="EMAIL"/>
		<result property="birth" column="BIRTH"/>
		<result property="gender" column="GENDER"/>
		<result property="warn_count" column="WARN_COUNT"/>
		<result property="quitYn" column="QUIT_YN"/>
		<result property="memType" column="MEM_TYPE"/>
		<result property="memPhone" column="MEM_PHONE"/>
		<result property="introduce" column="INTRODUCE"/>
		<result property="favoriteActi" column="FAVORITE_ACTI"/>

	</resultMap>
	
	<resultMap type="com.actibuddy.mypage.model.dto.CartDTO" id="CartResultMap">
		<id property="cartNum" column="CART_NUM"/>
		<result property="actiNum" column="ACTI_NUM"/>
		<result property="userId" column="USER_ID"/>
		<result property="chooseOption" column="CHOOSE_OPTION"/>
		<result property="totalPerson" column="TOTAL_PERSON"/>
		<result property="totalPrice" column="TOTAL_PRICE"/>
		<result property="chooseDate" column="CHOOSE_DATE"/>		
	</resultMap>
	
	<resultMap type="com.actibuddy.mypage.model.dto.PayHisDTO" id="PayHisResultMap">
		<result property="payNum" column="PAY_NUM"/>
		<result property="cartNum" column="CART_NUM"/>
		<result property="payStatus" column="PAY_STATUS"/>
		<result property="useYn" column="USE_YN"/>
	</resultMap>
	
	 <resultMap type="com.actibuddy.activity.model.dto.ActivityDTO" id="activityResultMap">
 	   <id property="code" column="ACTI_NUM"/>
 	   <result property="name" column="ACTI_NAME"/>
 	   <result property="location" column="LOCATION"/>
 	   <result property="price" column="PRICE"/>
 	   <result property="StartDate" column="START_DATE"/>
 	   <result property="EndDate" column="END_DATE"/>
 	   <result property="tip" column="ACTI_TIP"/>
 	   <result property="image" column="ACTI_IMG"/>
 	   <result property="loactionCode" column="LOCATION_CODE"/>
 	   <result property="activitTypeCode" column="ACTI_TYPE_NUM"/>
 	   <result property="userId" column="USER_ID"/>
 	</resultMap>
	
	
	<resultMap type="com.actibuddy.activity.model.dto.ActiReviewDTO" id="reviewResultMap">
 	<id property="num" column="ACTI_REVIEW_NUM"/>
 	<result property="writeDate" column="ACTI_REVIEW_DATE"/>
 	<result property="actiNum" column="ACTI_NUM"/>
 	<result property="writerId" column="WRITER_ID"/>
 	<result property="title" column="ACTI_REVIEW_TITLE"/>
 	<result property="content" column="ACTI_REVIEW_CON"/>
 	<result property="reviewStar" column="ACTI_REVIEW_STAR"/>
 	<result property="image" column="ACTI_REVIEW_IMG"/>
 	<result property="recommend" column="ACTI_REVIEW_REC"/>
 	<result property="recYn" column="ACTI_REVIEW_REP_YN"/>
 	<result property="chooseOption" column="CHOOSE_OPTION"/>
 	</resultMap>

	<resultMap type="com.actibuddy.mypage.model.dto.CartAndMemberAndPayHIsDTO" id="tripListResultMap">
		<result property="userId" column="USER_ID"/>
		<result property="userName" column="USER_NAME"/>
		<result property="pwd" column="PASSWORD"/>
		<result property="email" column="EMAIL"/>
		<result property="birth" column="BIRTH"/>
		<result property="gender" column="GENDER"/>
		<result property="warn_count" column="WARN_COUNT"/>
		<result property="quitYn" column="QUIT_YN"/>
		<result property="memType" column="MEM_TYPE"/>
		<result property="memPhone" column="MEM_PHONE"/>
		<result property="introduce" column="INTRODUCE"/>
		<result property="favoriteActi" column="FAVORITE_ACTI"/>
		<collection property="cartList" resultMap="CartResultMap"/>
		<collection property="payHisList" resultMap="PayHisResultMap"/>
		<collection property="activityInfo" resultMap="activityResultMap"/>
		<collection property="actiReview" resultMap="reviewResultMap"/>
	</resultMap>
	
	
	<update id="updateIntroduce" parameterType="com.actibuddy.member.model.dto.MemberDTO">
			UPDATE MEMBER A
			   SET A.INTRODUCE = #{ introduce }
			     , A.FAVORITE_ACTI = #{ favoriteActi }
		 	 WHERE A.USER_ID = #{ userId }
	</update>
	
	<update id="changeUseYn" parameterType="com.actibuddy.member.model.dto.MemberDTO">
	
		UPDATE PAY_HIS P
   		   SET USE_YN = 'Y'
   		 WHERE CART_NUM = #{cartNum};
 
 	</update>
 	
 	<select id="selectTripList" parameterType="String" resultMap="tripListResultMap" >
 	
			 	SELECT
			        A.ACTI_NAME
			      , A.ACTI_NUM
			      , C.CHOOSE_DATE
			      , C.TOTAL_PERSON
			      , C.CHOOSE_OPTION
			      , C.CART_NUM
			      , P.USE_YN
			      , M.USER_ID
			  FROM CART C
			 INNER JOIN ACTIVITY_INFO A
			    ON A.ACTI_NUM = C.ACTI_NUM
			 INNER JOIN PAY_HIS P
			    ON C.CART_NUM = P.CART_NUM
			 INNER JOIN MEMBER M
			    ON C.USER_ID = M.USER_ID
			 WHERE M.USER_ID = #{ userId }
 	
 	</select>
 	
 	<select id="selectCart" parameterType="String" resultMap="tripListResultMap">
 		
 		SELECT
			        A.ACTI_NAME
			      , C.CHOOSE_DATE
			      , C.TOTAL_PERSON
			      , C.CHOOSE_OPTION
			      , C.TOTAL_PRICE
			  FROM CART C
			 INNER JOIN ACTIVITY_INFO A
			    ON A.ACTI_NUM = C.ACTI_NUM
			 INNER JOIN PAY_HIS P
			    ON C.CART_NUM = P.CART_NUM
			 INNER JOIN MEMBER M
			    ON C.USER_ID = M.USER_ID
			 WHERE M.USER_ID = #{ userId }
 	
 	</select>

	<update id="updateReview"></update>
  
  </mapper>